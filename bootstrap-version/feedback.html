<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback — Bootstrap</title>
  <link rel="icon" href="data:,">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <style>
    :root {
      --color-bg: #f1f5f9;
      --color-panel: #ffffff;
      --color-text: #0f172a;
      --radius-xl: 16px;
      --shadow-md: 0 10px 28px rgba(2,6,23,.12);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body { min-height: 100%; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      -webkit-font-smoothing: antialiased;
    }
    .brand {
      position: fixed; top: 14px; left: 20px;
      font-weight: 700; font-size: .95rem; z-index: 200;
      will-change: transform;
    }
    .top-right {
      position: fixed; top: 12px; right: 16px;
      z-index: 200; display: flex; align-items: center; gap: .5rem;
      will-change: transform;
    }

    /* ── Page stack (scroll-safe flex column) ── */
    .page-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      min-height: 100vh;
      padding: 80px 16px 56px;
    }

    /* ── Step flow ── */
    .step-flow {
      display: flex; align-items: flex-start;
      width: 100%; max-width: 420px;
    }
    .step {
      display: flex; flex-direction: column;
      align-items: center; gap: .4rem;
      flex-shrink: 0; width: 80px;
    }
    .step__circle {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; border: 2px solid #cbd5e1;
      background: #fff; color: #94a3b8;
      transition: background .2s, border-color .2s, color .2s;
    }
    .step--done   .step__circle { background: #16a34a; border-color: #16a34a; color: #fff; }
    .step--active .step__circle { background: #2563eb; border-color: #2563eb; color: #fff; }
    .step__label {
      font-size: .7rem; font-weight: 600;
      color: #94a3b8; text-align: center; line-height: 1.2;
    }
    .step--done   .step__label { color: #16a34a; }
    .step--active .step__label { color: #2563eb; }
    .step__connector { flex: 1; height: 2px; background: #cbd5e1; margin-top: 21px; }
    .step__connector.done { background: #16a34a; }

    /* ── Panel card ── */
    .panel-card {
      width: min(820px, 100%);
      background: var(--color-panel);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      padding: 2rem 2.5rem;
    }
    @media (max-width: 600px) { .panel-card { padding: 1.25rem; } }

    .panel-card__header {
      display: flex; align-items: center; gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid #e2e8f0;
    }
    .panel-card__icon {
      width: 52px; height: 52px; border-radius: 14px;
      background: #eff6ff; color: #2563eb;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; flex-shrink: 0;
    }
    .panel-card__title { font-size: 1.35rem; font-weight: 700; margin: 0 0 .2rem; }
    .panel-card__subtitle { font-size: .88rem; color: #64748b; margin: 0; line-height: 1.5; }

    #fb, #history { min-height: 80px; }
    #fb:empty::after { content: 'Loading…'; opacity: .5; }

    /* ── Questionnaire card ── */
    .quest-card {
      width: min(820px, 100%);
      background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%);
      border-radius: var(--radius-xl);
      color: #fff;
      padding: 1.5rem 2rem;
      display: flex; align-items: center; gap: 1.5rem;
    }
    .quest-card__icon { font-size: 2rem; flex-shrink: 0; opacity: .9; }
    .quest-card__body { flex: 1; }
    .quest-card__body h3 { margin: 0 0 .35rem; font-size: 1.05rem; font-weight: 700; }
    .quest-card__body p  { margin: 0 0 .85rem; font-size: .88rem; opacity: .88; line-height: 1.5; }
    .quest-card .btn-quest {
      display: inline-flex; align-items: center; gap: .5rem;
      background: #fff; color: #1d4ed8;
      border: none; border-radius: 8px;
      padding: .55rem 1.25rem; font-weight: 700; font-size: .88rem;
      text-decoration: none; cursor: pointer;
      white-space: nowrap;
      transition: opacity .15s;
    }
    .quest-card .btn-quest:hover { opacity: .9; }
    @media (max-width: 540px) {
      .quest-card { flex-direction: column; text-align: center; }
    }
  </style>

  <!-- Font Awesome 6 -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"></noscript>

  <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"></noscript>

  <link href="../shared/css/tokens.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null">
  <link href="../shared/css/bridge-bootstrap.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null">
  <link href="../shared/css/app.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null">

  <link rel="modulepreload" href="../shared/js/app.js">
</head>

<body data-framework="bootstrap" data-page="feedback">
  <a class="skip-link" href="#main">Skip to main content</a>
  <div id="statusLive" class="visually-hidden" aria-live="polite"></div>

  <div class="brand">Bootstrap + Tokens</div>

  <div class="top-right">
    <a class="btn btn-sm btn-light" href="../admin/log.html" target="_blank" rel="noopener">
      <i class="fa-solid fa-terminal me-1"></i>Log
    </a>
    <div class="pill" style="display:flex;align-items:center;gap:.4rem;">
      <span id="pidBadge" style="font-size:.85rem;font-weight:600;">ID: …</span>
      <button id="logoutBtn" type="button" class="btn btn-sm btn-outline-secondary" title="Reset Study ID">
        <i class="fa-solid fa-rotate-left"></i>
      </button>
      <button id="copyIdBtn" class="btn btn-sm btn-outline-secondary" type="button" title="Copy Study ID">
        <i class="fa-regular fa-copy"></i>
      </button>
    </div>
  </div>

  <main id="main" class="page-stack" tabindex="-1">

    <!-- Step flow -->
    <nav class="step-flow" aria-label="Progress steps">
      <div class="step step--done">
        <div class="step__circle"><i class="fa-solid fa-check"></i></div>
        <span class="step__label">Sign In</span>
      </div>
      <div class="step__connector done"></div>
      <div class="step step--done">
        <div class="step__circle"><i class="fa-solid fa-check"></i></div>
        <span class="step__label">Submit</span>
      </div>
      <div class="step__connector done"></div>
      <div class="step step--active">
        <div class="step__circle"><i class="fa-solid fa-chart-bar"></i></div>
        <span class="step__label">Feedback</span>
      </div>
    </nav>

    <!-- Main panel card -->
    <div class="panel-card">
      <div class="panel-card__header">
        <div class="panel-card__icon">
          <i class="fa-solid fa-chart-bar"></i>
        </div>
        <div>
          <h1 class="panel-card__title">Your Submission Feedback</h1>
          <p class="panel-card__subtitle">Review your submitted assignments, compare your score against the pass mark, and read your teacher's comments.</p>
        </div>
      </div>

      <div id="fb" aria-live="polite"></div>
      <div id="history" class="mt-4"></div>
    </div>

    <!-- Questionnaire card (outside main panel) -->
    <div class="quest-card">
      <div class="quest-card__icon">
        <i class="fa-solid fa-clipboard-list"></i>
      </div>
      <div class="quest-card__body">
        <h3>Complete the Study Questionnaire</h3>
        <p>After reviewing your feedback, please fill in the SUS + UEQ usability questionnaire. Your Study ID will be pre-filled.</p>
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSfKiFssElyNNoaZ-PcQe2AoE-jSLSGaaoL-YyqCAY69zTVpBA/viewform"
           target="_blank" rel="noopener"
           class="btn-quest" id="questionnaireLink">
          <i class="fa-solid fa-arrow-up-right-from-square"></i> Open Questionnaire
        </a>
      </div>
    </div>

  </main>

  <button id="themeToggle" class="theme-switch" type="button" aria-label="Toggle theme" aria-pressed="false">Toggle theme</button>

  <script>
    if ('requestIdleCallback' in window) {
      requestIdleCallback(function () {
        const link = document.getElementById('questionnaireLink');
        if (!link) return;
        link.addEventListener('click', function () {
          try {
            const identity = JSON.parse(localStorage.getItem('study_identity_v1') || '{}');
            const framework = document.body.getAttribute('data-framework') || 'unknown';
            if (identity.studyId) {
              const url = new URL(this.href);
              url.searchParams.set('entry.STUDY_ID_FIELD', identity.studyId);
              url.searchParams.set('entry.VERSION_FIELD', framework);
              this.href = url.toString();
            }
          } catch (e) { console.error(e); }
        }, { once: true });
      });
    }
  </script>

  <script type="module" src="../shared/js/app.js"></script>
  <script defer src="../shared/js/metrics.js"></script>
  <script defer src="../shared/js/theme.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
