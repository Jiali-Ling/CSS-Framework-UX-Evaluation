<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../shared/css/tokens.css" rel="stylesheet">
  <link href="../shared/css/bridge-bootstrap.css" rel="stylesheet">
  <link href="../shared/css/app.css" rel="stylesheet">
</head>

<body data-framework="bootstrap" data-page="feedback">
  <a class="skip-link" href="#main">Skip to main content</a>
  <div id="statusLive" class="visually-hidden" aria-live="polite"></div>

  <div class="brand">Bootstrap + Tokens</div>

  <div class="top-right">
    <a class="btn btn-light" href="../admin/log.html" target="_blank" rel="noopener">Background log</a>

    <div class="pill" style="margin-left: .5rem;">
      <span id="pidBadge">Not logged in</span>
      <button id="logoutBtn" type="button" class="btn btn-sm btn-outline-secondary" style="margin-left:.5rem;">
        Reset ID
      </button>

      <button id="copyIdBtn" class="btn btn-outline-secondary btn-sm" type="button">
        Copy ID
      </button>
    </div>
  </div>

  <div id="main" class="center-stage" role="main" tabindex="-1">
    <div class="card login-card">
      <div class="card-body p-4 p-md-5">
        <h2 class="section-title">Feedback</h2>

        <div class="nav nav-tabs mb-3">
          <a class="nav-link" href="./index.html">Login</a>
          <a class="nav-link" href="./submit.html">Submit</a>
          <a class="nav-link active" aria-current="page" href="./feedback.html">Feedback</a>
        </div>

        <div id="fb" aria-live="polite">Loadingâ€¦</div>
        
        <p class="tip-text mt-3">Tip: export this table for analysis.</p>

        <div id="history" class="mt-3"></div>

        <div class="mt-4 p-3" style="background: var(--color-surface-2, #f8fafc); border-radius: 8px; border: 1px solid var(--color-border, #e2e8f0);">
          <h3 class="h6">ðŸ“‹ Please complete the study questionnaire</h3>
          <p class="text-muted mb-2">After reviewing your feedback, please fill out the usability questionnaire (SUS + UEQ). Your Study ID will be auto-filled.</p>
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSfKiFssElyNNoaZ-PcQe2AoE-jSLSGaaoL-YyqCAY69zTVpBA/viewform" target="_blank" rel="noopener" class="btn btn-primary" id="questionnaireLink">
            Open Questionnaire
          </a>
          <script>
            // Auto-fill study ID in the form URL
            document.getElementById('questionnaireLink')?.addEventListener('click', function(e) {
              const identity = JSON.parse(localStorage.getItem('study_identity_v1') || '{}');
              const version = localStorage.getItem('assigned_version') || 'unknown';
              const framework = document.body.getAttribute('data-framework') || 'unknown';
              if (identity.studyId) {
                const url = new URL(this.href);
                url.searchParams.set('entry.STUDY_ID_FIELD', identity.studyId);
                url.searchParams.set('entry.VERSION_FIELD', framework);
                this.href = url.toString();
              }
            });
          </script>
        </div>
      </div>
    </div>
  </div>

  <button id="themeToggle" class="theme-switch" type="button" aria-label="Toggle theme" aria-pressed="false">Toggle theme</button>



  <script type="module" src="../shared/js/app.js"></script>
  <script src="../shared/js/metrics.js"></script>
  <script defer src="../shared/js/theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
