<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback</title>
  
  <!-- Performance optimizations -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <link href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css" rel="stylesheet">
  <link href="../shared/css/tokens.css" rel="stylesheet">
  <link href="../shared/css/bridge-bulma.css" rel="stylesheet">
  <link href="../shared/css/app.css" rel="stylesheet">
</head>

<body data-framework="bulma" data-page="feedback">
  <a class="skip-link" href="#main">Skip to main content</a>
  <div id="statusLive" class="is-sr-only" aria-live="polite"></div>

  <div class="brand">Bulma + Tokens</div>

  <div class="top-right">
    <a class="button is-light" href="../admin/log.html" target="_blank" rel="noopener">Background log</a>

    <div class="pill" style="margin-left: .5rem;">
      <span id="pidBadge">Not logged in</span>
      <button id="logoutBtn" type="button" class="button is-small is-light" style="margin-left:.5rem;">
        Reset ID
      </button>
      <button id="copyIdBtn" class="button is-light is-small" type="button">
        Copy ID
      </button>
    </div>
  </div>

  <main id="main" class="center-stage" tabindex="-1">
    <div class="box login-card">
      <h2 class="title is-4 mb-3">Feedback</h2>

      <div class="tabs is-toggle is-fullwidth mb-4">
        <ul>
          <li><a href="./index.html">Login</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li class="is-active"><a aria-current="page">Feedback</a></li>
        </ul>
      </div>

      <div id="fb" aria-live="polite">Loadingâ€¦</div>

      <p class="tip-text mt-3">Tip: export this table for analysis.</p>

      <div id="history" class="mt-4"></div>

      <div class="notification is-light mt-4">
        <h3 class="subtitle is-6">ðŸ“‹ Please complete the study questionnaire</h3>
        <p class="has-text-grey mb-2">After reviewing your feedback, please fill out the usability questionnaire (SUS + UEQ). Your Study ID will be auto-filled.</p>
        <a href="https://forms.gle/YOUR_FORM_LINK" target="_blank" rel="noopener" class="button is-link" id="questionnaireLink">
          Open Questionnaire
        </a>
        <script>
          // Auto-fill study ID in the form URL
          document.getElementById('questionnaireLink')?.addEventListener('click', function(e) {
            const identity = JSON.parse(localStorage.getItem('study_identity_v1') || '{}');
            const version = localStorage.getItem('assigned_version') || 'unknown';
            const framework = document.body.getAttribute('data-framework') || 'unknown';
            if (identity.studyId) {
              const url = new URL(this.href);
              url.searchParams.set('entry.STUDY_ID_FIELD', identity.studyId);
              url.searchParams.set('entry.VERSION_FIELD', framework);
              this.href = url.toString();
            }
          });
        </script>
      </div>
    </div>
  </main>

  <button id="themeToggle" class="theme-switch" type="button" aria-label="Toggle theme" aria-pressed="false">Toggle theme</button>

  <script type="module" src="../shared/js/app.js"></script>
  <script src="../shared/js/metrics.js"></script>
  <script defer src="../shared/js/theme.js"></script>
</body>
</html>
